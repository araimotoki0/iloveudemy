<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>開発環境と本番環境 - Docker入門講座</title>
    <meta name="description" content="環境ごとに最適な設定を学ぼう">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🐳</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: { 400: '#22d3ee', 500: '#06b6d4' } },
                    fontFamily: { sans: ['Noto Sans JP', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="css/docker-common.css">
    <style>
        body { overflow-x: hidden; background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%); background-attachment: fixed; }
    </style>
</head>
<body class="text-white font-sans js-loading">
    <div class="min-h-screen flex flex-col">
        <main class="flex-grow py-12 px-4 sm:px-6 lg:px-8">
            <div class="max-w-5xl mx-auto">
                <div class="bg-slate-800/50 backdrop-blur-md rounded-2xl p-8 border border-slate-700/50 shadow-2xl">

                    <!-- 開発環境と本番環境の違い -->
                    <div class="content-section">
                        <h3>🌍 開発環境と本番環境の違い</h3>
                        <div class="collapsible-content">
                            <p class="text-lg mb-4">実際のプロジェクトでは、開発環境と本番環境で異なる設定が必要です。環境ごとの設定を効率的に管理する方法を学びます。</p>

                            <h4>主な違いの比較</h4>
                            <table class="comparison-table">
                                <thead>
                                    <tr>
                                        <th>項目</th>
                                        <th>開発環境</th>
                                        <th>本番環境</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="font-semibold">デバッグモード</td>
                                        <td class="text-green-400">✅ ON（詳細表示）</td>
                                        <td class="text-red-400">❌ OFF</td>
                                    </tr>
                                    <tr>
                                        <td class="font-semibold">ホットリロード</td>
                                        <td class="text-green-400">✅ 有効</td>
                                        <td>不要</td>
                                    </tr>
                                    <tr>
                                        <td class="font-semibold">ボリュームマウント</td>
                                        <td class="text-green-400">✅ 直接マウント</td>
                                        <td>イメージに含める</td>
                                    </tr>
                                    <tr>
                                        <td class="font-semibold">リソース制限</td>
                                        <td>制限なし/緩い</td>
                                        <td class="text-red-400">⚠️ 厳密に設定</td>
                                    </tr>
                                    <tr>
                                        <td class="font-semibold">HTTPS</td>
                                        <td>HTTP（localhost）</td>
                                        <td class="text-red-400">⚠️ HTTPS必須</td>
                                    </tr>
                                </tbody>
                            </table>

                            <div class="info-box">
                                <p class="font-semibold mb-2">💡 重要なポイント</p>
                                <p>開発環境では「開発者の作業効率」を優先し、本番環境では「セキュリティ・パフォーマンス・安定性」を優先します。</p>
                            </div>
                        </div>
                    </div>

                    <!-- 環境変数の外部化 -->
                    <div class="content-section">
                        <h3>🔐 環境変数の外部化と.envファイル</h3>
                        <div class="collapsible-content">
                            <p class="mb-4">パスワードやAPIキーなどの機密情報は、Composeファイルに直接書かずに.envファイルで管理します。</p>

                            <h4>.env.example（テンプレート）</h4>
                            <div class="command-box"># アプリケーション設定
APP_ENV=production
APP_DEBUG=false
APP_KEY=base64:ランダムな文字列をここに設定

# データベース設定
DB_HOST=db
DB_DATABASE=laravel
DB_USERNAME=root
DB_PASSWORD=強固なパスワードをここに設定</div>

                            <div class="warning-box">
                                <p class="font-semibold mb-2">⚠️ セキュリティ上の注意</p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li><strong>.envファイルは.gitignoreに追加</strong> → Gitにコミットしない</li>
                                    <li><strong>.env.exampleは共有OK</strong> → テンプレートとして使う</li>
                                    <li><strong>本番環境では強固なパスワード</strong> → 12文字以上、記号含む</li>
                                </ul>
                            </div>

                            <h4>.gitignore</h4>
                            <div class="command-box"># 機密情報を含むファイルを除外
.env
.env.local
.env.production

# .env.exampleはコミットしてOK
!.env.example</div>
                        </div>
                    </div>

                    <!-- 複数のComposeファイルの組み合わせ -->
                    <div class="content-section">
                        <h3>📁 複数のComposeファイルの組み合わせ</h3>
                        <div class="collapsible-content">
                            <p class="mb-4">Docker Composeは、複数のファイルを組み合わせて使用できます。共通設定と環境別設定を分離できます。</p>

                            <h4>推奨ファイル構成</h4>
                            <div class="command-box">project/
├── docker-compose.yml         # 共通設定
├── docker-compose.dev.yml     # 開発環境専用
├── docker-compose.prod.yml    # 本番環境専用
└── .env                       # 環境変数</div>

                            <h4>使い方</h4>
                            <div class="command-box"># 開発環境で起動
docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d

# 本番環境で起動
docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d</div>

                            <div class="success-box">
                                <p class="font-semibold mb-2">✅ この構成のメリット</p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>共通設定を一元管理 → 重複を避ける</li>
                                    <li>環境別の差分だけを記述 → 見通しが良い</li>
                                    <li>間違った環境で起動するミスを防ぐ</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 本番環境での注意点 -->
                    <div class="content-section">
                        <h3>🔒 本番環境での注意点</h3>
                        <div class="collapsible-content">
                            <h4>セキュリティ</h4>
                            <div class="error-box">
                                <p class="font-semibold mb-2">❌ 絶対にやってはいけないこと</p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>パスワードをComposeファイルに直接書く</li>
                                    <li>.envファイルをGitにコミットする</li>
                                    <li>APP_DEBUG=trueのまま本番稼働</li>
                                    <li>データベースポート（3306）を公開する</li>
                                    <li>HTTP（非暗号化）で本番運用</li>
                                </ul>
                            </div>

                            <div class="success-box">
                                <p class="font-semibold mb-2">✅ 必ずやるべきこと</p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>強固なパスワードを使用（12文字以上、記号含む）</li>
                                    <li>HTTPS/SSL証明書の設定</li>
                                    <li>非rootユーザーでコンテナを実行</li>
                                    <li>必要なポートだけを公開</li>
                                    <li>定期的なバックアップ</li>
                                </ul>
                            </div>

                            <h4>リソース管理</h4>
                            <div class="command-box">services:
  app:
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M</div>

                            <h4>自動再起動</h4>
                            <div class="command-box">services:
  app:
    restart: always  # 常に再起動</div>
                        </div>
                    </div>

                </div>
            </div>
        </main>
    </div>
    <script src="course-config.js"></script>
    <script src="../js/header.js"></script>
    <script src="../js/sidebar.js"></script>
    <script src="../js/footer.js"></script>
    <script src="js/docker-common.js"></script>
</body>
</html>
