<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ボリューム - Docker入門講座</title>
    <meta name="description" content="Dockerボリュームの本質をハンズオンで学ぶ">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🐳</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: { 400: '#22d3ee', 500: '#06b6d4' } },
                    fontFamily: { sans: ['Noto Sans JP', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="css/docker-common.css">
    <style>
        body { overflow-x: hidden; background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%); background-attachment: fixed; }
    </style>
</head>
<body class="text-white font-sans js-loading">
    <div class="min-h-screen flex flex-col">
        <main class="flex-grow py-12 px-4 sm:px-6 lg:px-8">
            <div class="max-w-5xl mx-auto">
                <div class="bg-slate-800/50 backdrop-blur-md rounded-2xl p-8 border border-slate-700/50 shadow-2xl">

                    <!-- 導入 -->
                    <div class="content-section">
                        <h3>💾 ボリュームとは</h3>
                        <div class="collapsible-content">
                            <p class="text-lg mb-6">
                                Docker Compose で <code>mysql-data:/var/lib/mysql</code> と書きましたよね？<br>
                                なぜこれが必要なのか、体験しながら理解しましょう。
                            </p>

                            <div class="bg-slate-700/30 p-6 rounded-xl mb-6">
                                <div class="text-xl font-bold text-center mb-4">覚えることは2つだけ</div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-cyan-900/30 border border-cyan-500/30 p-4 rounded-lg text-center">
                                        <div class="text-2xl mb-2">1</div>
                                        <div class="font-bold text-cyan-300">名前付きボリューム</div>
                                        <p class="text-sm text-gray-300 mt-2">データを永続化する</p>
                                    </div>
                                    <div class="bg-green-900/30 border border-green-500/30 p-4 rounded-lg text-center">
                                        <div class="text-2xl mb-2">2</div>
                                        <div class="font-bold text-green-300">バインドマウント</div>
                                        <p class="text-sm text-gray-300 mt-2">ソースコードを同期する</p>
                                    </div>
                                </div>
                            </div>

                            <p class="text-gray-300">
                                実際に手を動かして体験していきましょう。
                            </p>
                        </div>
                    </div>

                    <!-- ハンズオン1: データが消える -->
                    <div class="content-section">
                        <h3>❌ ハンズオン1: データが消える</h3>
                        <div class="collapsible-content">
                            <p class="text-lg mb-6">
                                コンテナを削除すると、中のデータはどうなるでしょう？<br>
                                実際に確認してみましょう。
                            </p>

                            <div class="bg-slate-700/30 p-6 rounded-xl mb-6">
                                <div class="font-bold text-lg mb-4">Step 1: コンテナ内にファイルを作成</div>

                                <div class="command-box mb-4">
                                    <div class="command"># alpine コンテナを起動してファイルを作成</div>
                                    <div class="command">docker run --name test alpine sh -c "echo 'Hello Docker' > /data.txt && cat /data.txt"</div>
                                    <div class="output" style="color: #22c55e;">
Hello Docker
                                    </div>
                                </div>

                                <p class="text-gray-300 text-sm">
                                    コンテナ内に <code>/data.txt</code> を作成しました。
                                </p>
                            </div>

                            <div class="bg-slate-700/30 p-6 rounded-xl mb-6">
                                <div class="font-bold text-lg mb-4">Step 2: コンテナを削除して再作成</div>

                                <div class="command-box mb-4">
                                    <div class="command"># コンテナを削除</div>
                                    <div class="command">docker rm test</div>
                                </div>

                                <div class="command-box mb-4">
                                    <div class="command"># 同じ名前で新しいコンテナを起動してファイルを確認</div>
                                    <div class="command">docker run --name test alpine cat /data.txt</div>
                                    <div class="output" style="color: #ef4444;">
cat: can't open '/data.txt': No such file or directory
                                    </div>
                                </div>

                                <div class="bg-red-900/30 border border-red-500/30 rounded-lg p-4">
                                    <div class="font-bold text-red-300 mb-2">結果: データが消えた！</div>
                                    <p class="text-sm">
                                        コンテナを削除すると、中のデータも一緒に消えます。
                                    </p>
                                </div>
                            </div>

                            <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-6 mb-6">
                                <div class="font-bold text-yellow-300 mb-3">なぜ消える？</div>
                                <p class="mb-4">
                                    コンテナは「使い捨て」が基本思想です。
                                </p>
                                <div class="flex items-center justify-center gap-4 my-4">
                                    <div class="bg-slate-800 border-2 border-slate-600 rounded-lg p-4 text-center">
                                        <div class="font-bold text-white mb-2">コンテナ</div>
                                        <div class="text-sm text-gray-400">data.txt</div>
                                    </div>
                                    <div class="text-red-400 text-xl">→ 削除 →</div>
                                    <div class="bg-slate-800 border-2 border-red-500/50 rounded-lg p-4 text-center opacity-50">
                                        <div class="font-bold text-white mb-2">消滅</div>
                                        <div class="text-sm text-red-400 line-through">data.txt</div>
                                    </div>
                                </div>
                                <p class="mt-4 text-sm text-gray-300">
                                    DBのデータも同じ。<code>docker compose down</code> すると消えます。<br>
                                    だからボリュームが必要なんです。
                                </p>
                            </div>

                            <div class="bg-slate-700/30 p-6 rounded-xl">
                                <div class="font-bold text-lg mb-4">Step 3: 後片付け</div>
                                <div class="command-box">
                                    <div class="command">docker rm test</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ハンズオン2: 名前付きボリュームで永続化 -->
                    <div class="content-section">
                        <h3>✅ ハンズオン2: ボリュームで永続化</h3>
                        <div class="collapsible-content">
                            <p class="text-lg mb-6">
                                <strong>名前付きボリューム</strong>を使うと、コンテナを消してもデータが残ります。
                            </p>

                            <div class="bg-slate-700/30 p-6 rounded-xl mb-6">
                                <div class="font-bold text-lg mb-4">Step 1: ボリュームを使ってファイルを作成</div>

                                <div class="command-box mb-4">
                                    <div class="command"># mydata ボリュームを /data にマウントしてファイル作成</div>
                                    <div class="command">docker run --name test -v mydata:/data alpine sh -c "echo 'Hello Docker' > /data/test.txt && cat /data/test.txt"</div>
                                    <div class="output" style="color: #22c55e;">
Hello Docker
                                    </div>
                                </div>

                                <p class="text-gray-300 text-sm">
                                    <code>-v mydata:/data</code> で名前付きボリューム「mydata」を <code>/data</code> にマウントしました。
                                </p>
                            </div>

                            <div class="bg-slate-700/30 p-6 rounded-xl mb-6">
                                <div class="font-bold text-lg mb-4">Step 2: コンテナを削除して再作成</div>

                                <div class="command-box mb-4">
                                    <div class="command"># コンテナを削除</div>
                                    <div class="command">docker rm test</div>
                                </div>

                                <div class="command-box mb-4">
                                    <div class="command"># 新しいコンテナで同じボリュームをマウントして確認</div>
                                    <div class="command">docker run --name test -v mydata:/data alpine cat /data/test.txt</div>
                                    <div class="output" style="color: #22c55e;">
Hello Docker
                                    </div>
                                </div>

                                <div class="bg-green-900/30 border border-green-500/30 rounded-lg p-4">
                                    <div class="font-bold text-green-300 mb-2">結果: データが残ってる！</div>
                                    <p class="text-sm">
                                        コンテナを削除しても、ボリュームのデータは消えません。
                                    </p>
                                </div>
                            </div>

                            <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-6 mb-6">
                                <div class="font-bold text-blue-300 mb-3">なぜ残る？</div>
                                <div class="flex items-center justify-center gap-4 my-4">
                                    <div class="bg-slate-800 border-2 border-slate-600 rounded-lg p-4 text-center">
                                        <div class="font-bold text-white mb-2">コンテナ</div>
                                        <div class="text-xs text-gray-400">/data → mydata</div>
                                    </div>
                                    <div class="text-gray-400 text-xl">→ 削除 →</div>
                                    <div class="bg-slate-800 border-2 border-red-500/50 rounded-lg p-4 text-center opacity-50">
                                        <div class="font-bold text-white mb-2">消滅</div>
                                    </div>
                                </div>
                                <div class="flex justify-center my-2">
                                    <div class="bg-cyan-900/50 border-2 border-cyan-500/50 rounded-lg p-4 text-center">
                                        <div class="font-bold text-cyan-300 mb-2">mydata ボリューム</div>
                                        <div class="text-sm text-white">test.txt → 残ってる！</div>
                                    </div>
                                </div>
                                <p class="mt-4 text-sm text-gray-300 text-center">
                                    ボリュームはコンテナとは別に管理されるので、消えません。
                                </p>
                            </div>

                            <div class="bg-slate-700/30 p-6 rounded-xl">
                                <div class="font-bold text-lg mb-4">Step 3: 後片付け</div>
                                <div class="command-box mb-4">
                                    <div class="command">docker rm test</div>
                                </div>
                                <div class="command-box">
                                    <div class="command"># ボリュームも削除する場合</div>
                                    <div class="command">docker volume rm mydata</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ハンズオン3: バインドマウント -->
                    <div class="content-section">
                        <h3>📂 ハンズオン3: バインドマウント</h3>
                        <div class="collapsible-content">
                            <p class="text-lg mb-6">
                                <strong>バインドマウント</strong>は、ホスト（自分のPC）のフォルダをコンテナに接続します。<br>
                                開発時にソースコードを同期するのに使います。
                            </p>

                            <div class="bg-slate-700/30 p-6 rounded-xl mb-6">
                                <div class="font-bold text-lg mb-4">Step 1: ホストにファイルを作成</div>

                                <div class="command-box mb-4">
                                    <div class="command"># テスト用フォルダを作成</div>
                                    <div class="command">mkdir -p ~/docker-test && cd ~/docker-test</div>
                                </div>

                                <div class="command-box mb-4">
                                    <div class="command"># HTMLファイルを作成</div>
                                    <div class="command">echo '&lt;h1&gt;Hello from Host!&lt;/h1&gt;' > index.html</div>
                                </div>
                            </div>

                            <div class="bg-slate-700/30 p-6 rounded-xl mb-6">
                                <div class="font-bold text-lg mb-4">Step 2: バインドマウントでコンテナ起動</div>

                                <div class="command-box mb-4">
                                    <div class="command"># カレントディレクトリをnginxの公開フォルダにマウント</div>
                                    <div class="command">docker run -d --name web -p 8080:80 -v $(pwd):/usr/share/nginx/html nginx</div>
                                </div>

                                <p class="text-gray-300 text-sm mb-4">
                                    <code>-v $(pwd):/usr/share/nginx/html</code> で現在のフォルダをマウントしました。
                                </p>

                                <div class="command-box">
                                    <div class="command"># ブラウザで確認</div>
                                    <div class="command">open http://localhost:8080  # Mac</div>
                                    <div class="command"># または http://localhost:8080 をブラウザで開く</div>
                                </div>
                            </div>

                            <div class="bg-slate-700/30 p-6 rounded-xl mb-6">
                                <div class="font-bold text-lg mb-4">Step 3: ホスト側でファイルを編集</div>

                                <div class="command-box mb-4">
                                    <div class="command"># ホスト側でファイルを変更</div>
                                    <div class="command">echo '&lt;h1&gt;Updated!&lt;/h1&gt;' > index.html</div>
                                </div>

                                <div class="bg-green-900/30 border border-green-500/30 rounded-lg p-4">
                                    <div class="font-bold text-green-300 mb-2">結果: ブラウザをリロード → 即座に反映！</div>
                                    <p class="text-sm">
                                        コンテナを再起動しなくても、ホスト側の変更がリアルタイムで反映されます。
                                    </p>
                                </div>
                            </div>

                            <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-6 mb-6">
                                <div class="font-bold text-blue-300 mb-3">これが開発で便利な理由</div>
                                <div class="flex items-center justify-center gap-4 my-4">
                                    <div class="bg-slate-800 border-2 border-green-500/50 rounded-lg p-4 text-center">
                                        <div class="font-bold text-white mb-2">ホスト（あなたのPC）</div>
                                        <div class="text-sm text-green-400">VSCode で編集</div>
                                    </div>
                                    <div class="text-green-400 text-xl">⟷</div>
                                    <div class="bg-slate-800 border-2 border-green-500/50 rounded-lg p-4 text-center">
                                        <div class="font-bold text-white mb-2">コンテナ</div>
                                        <div class="text-sm text-green-400">即座に反映</div>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-300 text-center">
                                    ソースコードをホストで編集 → コンテナに自動反映 → ブラウザで確認
                                </p>
                            </div>

                            <div class="bg-slate-700/30 p-6 rounded-xl">
                                <div class="font-bold text-lg mb-4">Step 4: 後片付け</div>
                                <div class="command-box mb-4">
                                    <div class="command">docker rm -f web</div>
                                </div>
                                <div class="command-box">
                                    <div class="command">rm -rf ~/docker-test</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Docker Compose での書き方 -->
                    <div class="content-section">
                        <h3>🐳 Docker Compose での書き方</h3>
                        <div class="collapsible-content">
                            <p class="text-lg mb-6">
                                Docker Compose では <code>volumes:</code> で簡単に設定できます。
                            </p>

                            <div class="bg-slate-700/30 p-6 rounded-xl mb-6">
                                <div class="font-bold text-lg mb-4">よくある構成</div>

                                <div class="bg-slate-800/50 p-4 rounded font-mono text-sm mb-4">
                                    <div class="text-gray-400"># docker-compose.yml</div>
                                    <div>services:</div>
                                    <div>&nbsp;&nbsp;app:</div>
                                    <div>&nbsp;&nbsp;&nbsp;&nbsp;build: .</div>
                                    <div>&nbsp;&nbsp;&nbsp;&nbsp;volumes:</div>
                                    <div class="text-green-400">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- ./src:/var/www/html  # バインドマウント（ソースコード）</div>
                                    <div></div>
                                    <div>&nbsp;&nbsp;db:</div>
                                    <div>&nbsp;&nbsp;&nbsp;&nbsp;image: mysql:8.0</div>
                                    <div>&nbsp;&nbsp;&nbsp;&nbsp;volumes:</div>
                                    <div class="text-cyan-400">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- mysql-data:/var/lib/mysql  # 名前付きボリューム（DBデータ）</div>
                                    <div></div>
                                    <div class="text-cyan-400">volumes:</div>
                                    <div class="text-cyan-400">&nbsp;&nbsp;mysql-data:  # ボリュームを定義</div>
                                </div>

                                <div class="space-y-3">
                                    <div class="flex items-start">
                                        <span class="text-green-400 mr-3">→</span>
                                        <span><code>./src:/var/www/html</code> = バインドマウント（<code>./</code> で始まる）</span>
                                    </div>
                                    <div class="flex items-start">
                                        <span class="text-cyan-400 mr-3">→</span>
                                        <span><code>mysql-data:/var/lib/mysql</code> = 名前付きボリューム（名前だけ）</span>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-6 mb-6">
                                <div class="font-bold text-yellow-300 mb-3">見分け方</div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-slate-800/50 p-4 rounded">
                                        <div class="text-green-400 font-bold mb-2">バインドマウント</div>
                                        <code class="text-sm">./src:/var/www/html</code>
                                        <p class="text-xs text-gray-400 mt-2">パス（<code>./</code> や <code>/</code>）で始まる</p>
                                    </div>
                                    <div class="bg-slate-800/50 p-4 rounded">
                                        <div class="text-cyan-400 font-bold mb-2">名前付きボリューム</div>
                                        <code class="text-sm">mysql-data:/var/lib/mysql</code>
                                        <p class="text-xs text-gray-400 mt-2">名前だけ（トップレベルで定義）</p>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-red-900/20 border border-red-500/30 rounded-lg p-6">
                                <div class="font-bold text-red-300 mb-3">注意: docker compose down -v</div>
                                <div class="bg-slate-800/50 p-4 rounded font-mono text-sm mb-4">
                                    <div class="text-gray-400"># 通常の停止（ボリュームは残る）</div>
                                    <div>docker compose down</div>
                                    <div class="mt-3"></div>
                                    <div class="text-red-400"># ボリュームも削除（データが消える！）</div>
                                    <div class="text-red-400">docker compose down -v</div>
                                </div>
                                <p class="text-sm text-gray-300">
                                    <code>-v</code> をつけると名前付きボリュームも削除されます。<br>
                                    DBのデータを消したくない場合は <code>-v</code> をつけないでください。
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- まとめ -->
                    <div class="content-section">
                        <h3>🎯 まとめ</h3>
                        <div class="collapsible-content">

                            <div class="bg-slate-700/30 p-6 rounded-xl mb-6">
                                <div class="text-xl font-bold text-center mb-6">ボリュームの本質</div>

                                <div class="space-y-6">
                                    <div class="flex items-start">
                                        <div class="bg-red-500 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold mr-4 flex-shrink-0">!</div>
                                        <div>
                                            <div class="font-bold text-lg">コンテナを消すとデータも消える</div>
                                            <p class="text-gray-300">コンテナは使い捨て。中のデータは永続化されない。</p>
                                        </div>
                                    </div>

                                    <div class="flex items-start">
                                        <div class="bg-cyan-500 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold mr-4 flex-shrink-0">1</div>
                                        <div>
                                            <div class="font-bold text-lg">名前付きボリューム = データ永続化</div>
                                            <p class="text-gray-300">DBのデータなど、消えてほしくないものに使う。</p>
                                            <code class="text-sm text-cyan-400">mysql-data:/var/lib/mysql</code>
                                        </div>
                                    </div>

                                    <div class="flex items-start">
                                        <div class="bg-green-500 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold mr-4 flex-shrink-0">2</div>
                                        <div>
                                            <div class="font-bold text-lg">バインドマウント = ソースコード同期</div>
                                            <p class="text-gray-300">ホストで編集 → コンテナに即反映。開発時に使う。</p>
                                            <code class="text-sm text-green-400">./src:/var/www/html</code>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-6 mb-6">
                                <div class="font-bold text-blue-300 mb-3">使い分け</div>
                                <table class="w-full text-sm">
                                    <thead>
                                        <tr class="border-b border-slate-600">
                                            <th class="text-left py-2">用途</th>
                                            <th class="text-left py-2">方式</th>
                                            <th class="text-left py-2">例</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="border-b border-slate-700">
                                            <td class="py-2">DBデータ</td>
                                            <td class="text-cyan-400">名前付きボリューム</td>
                                            <td><code>mysql-data:/var/lib/mysql</code></td>
                                        </tr>
                                        <tr class="border-b border-slate-700">
                                            <td class="py-2">ソースコード</td>
                                            <td class="text-green-400">バインドマウント</td>
                                            <td><code>./src:/var/www/html</code></td>
                                        </tr>
                                        <tr>
                                            <td class="py-2">設定ファイル</td>
                                            <td class="text-green-400">バインドマウント</td>
                                            <td><code>./php.ini:/usr/local/etc/php/php.ini</code></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="success-box">
                                <h4>✅ 理解できたこと</h4>
                                <ul>
                                    <li>コンテナを消すとデータも消える</li>
                                    <li>名前付きボリュームでデータを永続化できる</li>
                                    <li>バインドマウントでソースコードを同期できる</li>
                                    <li><code>docker compose down -v</code> はボリュームも消える</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </main>
    </div>
    <script src="course-config.js"></script>
    <script src="../js/header.js"></script>
    <script src="../js/sidebar.js"></script>
    <script src="../js/footer.js"></script>
    <script src="js/docker-common.js"></script>
</body>
</html>
