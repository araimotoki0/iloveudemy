<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ネットワーク - Docker入門講座</title>
    <meta name="description" content="Dockerネットワークの本質をハンズオンで学ぶ">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🐳</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: { 400: '#22d3ee', 500: '#06b6d4' } },
                    fontFamily: { sans: ['Noto Sans JP', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="css/docker-common.css">
    <style>
        body { overflow-x: hidden; background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%); background-attachment: fixed; }
    </style>
</head>
<body class="text-white font-sans js-loading">
    <div class="min-h-screen flex flex-col">
        <main class="flex-grow py-12 px-4 sm:px-6 lg:px-8">
            <div class="max-w-5xl mx-auto">
                <div class="bg-slate-800/50 backdrop-blur-md rounded-2xl p-8 border border-slate-700/50 shadow-2xl">

                    <!-- 導入 -->
                    <div class="content-section">
                        <h3>🌐 Dockerネットワークとは</h3>
                        <div class="collapsible-content">
                            <p class="text-lg mb-6">
                                Docker Composeで <code>db</code> と書くだけでデータベースに繋がりましたよね？<br>
                                なぜ繋がるのか、その仕組みを理解しましょう。
                            </p>

                            <div class="bg-slate-700/30 p-6 rounded-xl mb-6">
                                <div class="text-xl font-bold text-center mb-4">覚えることは3つだけ</div>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="bg-red-900/30 border border-red-500/30 p-4 rounded-lg text-center">
                                        <div class="text-2xl mb-2">1</div>
                                        <div class="font-bold text-red-300">コンテナは孤立</div>
                                        <p class="text-sm text-gray-300 mt-2">localhost は使えない</p>
                                    </div>
                                    <div class="bg-green-900/30 border border-green-500/30 p-4 rounded-lg text-center">
                                        <div class="text-2xl mb-2">2</div>
                                        <div class="font-bold text-green-300">同じネットワーク</div>
                                        <p class="text-sm text-gray-300 mt-2">= サービス名で通信OK</p>
                                    </div>
                                    <div class="bg-blue-900/30 border border-blue-500/30 p-4 rounded-lg text-center">
                                        <div class="text-2xl mb-2">3</div>
                                        <div class="font-bold text-blue-300">Docker Compose</div>
                                        <p class="text-sm text-gray-300 mt-2">自動でやってくれる</p>
                                    </div>
                                </div>
                            </div>

                            <p class="text-gray-300">
                                実際に手を動かして体験していきましょう。
                            </p>
                        </div>
                    </div>

                    <!-- ハンズオン1: コンテナは孤立している -->
                    <div class="content-section">
                        <h3>❌ ハンズオン1: コンテナは孤立している</h3>
                        <div class="collapsible-content">
                            <p class="text-lg mb-6">
                                同じPCで動いているコンテナ同士、繋がると思いますよね？<br>
                                実は<strong>繋がりません</strong>。確認してみましょう。
                            </p>

                            <div class="bg-slate-700/30 p-6 rounded-xl mb-6">
                                <div class="font-bold text-lg mb-4">Step 1: 2つのコンテナを起動</div>

                                <div class="command-box mb-4">
                                    <div class="command"># コンテナA を起動</div>
                                    <div class="command">docker container run -d --name containerA alpine sleep 3600</div>
                                </div>

                                <div class="command-box mb-4">
                                    <div class="command"># コンテナB を起動</div>
                                    <div class="command">docker container run -d --name containerB alpine sleep 3600</div>
                                </div>

                                <p class="text-gray-300 text-sm">
                                    2つのコンテナが同じPCで動いています。
                                </p>
                            </div>

                            <div class="bg-slate-700/30 p-6 rounded-xl mb-6">
                                <div class="font-bold text-lg mb-4">Step 2: 通信を試みる</div>

                                <div class="command-box mb-4">
                                    <div class="command"># containerA から containerB に ping してみる</div>
                                    <div class="command"># ping = 通信できるか確認するコマンド、-c 3 = 3回だけ実行</div>
                                    <div class="command">docker container exec containerA ping -c 3 containerB</div>
                                    <div class="output" style="color: #ef4444;">
ping: bad address 'containerB'
                                    </div>
                                </div>

                                <div class="bg-red-900/30 border border-red-500/30 rounded-lg p-4">
                                    <div class="font-bold text-red-300 mb-2">結果: 繋がらない！</div>
                                    <p class="text-sm">
                                        同じPCで動いているのに、コンテナ同士は通信できません。
                                    </p>
                                </div>
                            </div>

                            <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-6 mb-6">
                                <div class="font-bold text-yellow-300 mb-3">なぜ繋がらない？</div>
                                <p class="mb-4">
                                    各コンテナは<strong>独立したネットワーク空間</strong>を持っています。
                                </p>
                                <div class="flex items-center justify-center gap-8 my-4">
                                    <div class="bg-slate-800 border-2 border-red-500/50 rounded-lg p-4 text-center">
                                        <div class="font-bold text-white">containerA</div>
                                    </div>
                                    <div class="text-red-400 text-2xl">✕</div>
                                    <div class="bg-slate-800 border-2 border-red-500/50 rounded-lg p-4 text-center">
                                        <div class="font-bold text-white">containerB</div>
                                    </div>
                                </div>
                                <div class="text-center text-red-400 text-sm">繋がっていない</div>
                                <p class="mt-4 text-sm text-gray-300">
                                    コンテナはデフォルトで<strong>孤立</strong>しています。<br>
                                    同じPCで動いていても、ネットワークが別なので名前で見つけられません。
                                </p>
                            </div>

                            <div class="bg-slate-700/30 p-6 rounded-xl">
                                <div class="font-bold text-lg mb-4">Step 3: 後片付け</div>
                                <div class="command-box">
                                    <div class="command">docker container rm -f containerA containerB</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ハンズオン2: ネットワークで繋げる -->
                    <div class="content-section">
                        <h3>✅ ハンズオン2: ネットワークで繋げる</h3>
                        <div class="collapsible-content">
                            <p class="text-lg mb-6">
                                コンテナを繋げるには<strong>同じネットワーク</strong>に入れます。<br>
                                すると、コンテナ名で通信できるようになります。
                            </p>

                            <div class="bg-slate-700/30 p-6 rounded-xl mb-6">
                                <div class="font-bold text-lg mb-4">Step 1: ネットワークを作成</div>

                                <div class="command-box mb-4">
                                    <div class="command">docker network create mynet</div>
                                    <div class="output">
a1b2c3d4e5f6...  ← ネットワークIDが表示される
                                    </div>
                                </div>

                                <p class="text-gray-300 text-sm">
                                    <code>mynet</code> という名前のネットワークができました。
                                </p>
                            </div>

                            <div class="bg-slate-700/30 p-6 rounded-xl mb-6">
                                <div class="font-bold text-lg mb-4">Step 2: 同じネットワークでコンテナを起動</div>

                                <div class="command-box mb-4">
                                    <div class="command"># containerA を mynet に接続して起動</div>
                                    <div class="command">docker container run -d --name containerA --network mynet alpine sleep 3600</div>
                                </div>

                                <div class="command-box mb-4">
                                    <div class="command"># containerB も mynet に接続して起動</div>
                                    <div class="command">docker container run -d --name containerB --network mynet alpine sleep 3600</div>
                                </div>

                                <div class="bg-green-900/20 border-2 border-green-500/50 rounded-xl p-4 my-4">
                                    <div class="text-center text-green-400 font-bold mb-4">mynet</div>
                                    <div class="flex items-center justify-center gap-4">
                                        <div class="bg-slate-800 border border-slate-600 rounded-lg p-3 text-center">
                                            <div class="font-bold text-white">containerA</div>
                                        </div>
                                        <div class="text-green-400 text-xl">⟷</div>
                                        <div class="bg-slate-800 border border-slate-600 rounded-lg p-3 text-center">
                                            <div class="font-bold text-white">containerB</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-center text-green-400 text-sm">同じネットワーク = 通信OK</div>
                            </div>

                            <div class="bg-slate-700/30 p-6 rounded-xl mb-6">
                                <div class="font-bold text-lg mb-4">Step 3: 通信してみる</div>

                                <div class="command-box mb-4">
                                    <div class="command"># containerA から containerB に ping</div>
                                    <div class="command">docker container exec containerA ping -c 3 containerB</div>
                                    <div class="output" style="color: #22c55e;">
PING containerB (172.18.0.3): 56 data bytes
64 bytes from 172.18.0.3: seq=0 ttl=64 time=0.089 ms
64 bytes from 172.18.0.3: seq=1 ttl=64 time=0.085 ms
64 bytes from 172.18.0.3: seq=2 ttl=64 time=0.087 ms
                                    </div>
                                </div>

                                <div class="bg-green-900/30 border border-green-500/30 rounded-lg p-4">
                                    <div class="font-bold text-green-300 mb-2">結果: 繋がった！</div>
                                    <p class="text-sm">
                                        <code>containerB</code> という<strong>名前</strong>で通信できています。<br>
                                        IPアドレス（172.18.0.3）を知らなくても大丈夫です。
                                    </p>
                                </div>
                            </div>

                            <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-6 mb-6">
                                <div class="font-bold text-blue-300 mb-3">なぜ名前で繋がる？</div>
                                <p class="text-sm">
                                    Dockerが<strong>コンテナ名をIPアドレスに自動変換</strong>してくれます。<br>
                                    <code>containerB</code> → <code>172.18.0.3</code>
                                </p>
                            </div>

                            <div class="bg-slate-700/30 p-6 rounded-xl">
                                <div class="font-bold text-lg mb-4">Step 4: 後片付け</div>
                                <div class="command-box mb-4">
                                    <div class="command">docker container rm -f containerA containerB</div>
                                </div>
                                <div class="command-box">
                                    <div class="command">docker network rm mynet</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 外は閉じてるけど中は自由 -->
                    <div class="content-section">
                        <h3>🔒 外は閉じてるけど中は自由</h3>
                        <div class="collapsible-content">
                            <p class="text-lg mb-6">
                                ネットワークのもう一つの重要なポイント。<br>
                                <strong>外部からのアクセス</strong>と<strong>コンテナ間通信</strong>は別物です。
                            </p>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div class="bg-red-900/20 border border-red-500/30 p-6 rounded-xl">
                                    <div class="text-xl font-bold mb-3">外部 → コンテナ</div>
                                    <div class="text-red-300 font-bold mb-3">ports: が必要</div>
                                    <div class="bg-slate-800/50 p-3 rounded font-mono text-sm mb-3">
                                        ports:<br>
                                        &nbsp;&nbsp;- "8080:80"
                                    </div>
                                    <p class="text-sm text-gray-300">
                                        明示的にポートを開けないと<br>外からアクセスできない
                                    </p>
                                </div>

                                <div class="bg-green-900/20 border border-green-500/30 p-6 rounded-xl">
                                    <div class="text-xl font-bold mb-3">コンテナ → コンテナ</div>
                                    <div class="text-green-300 font-bold mb-3">設定不要で自由</div>
                                    <div class="bg-slate-800/50 p-3 rounded font-mono text-sm mb-3">
                                        DB_HOST=db<br>
                                        DB_PORT=3306
                                    </div>
                                    <p class="text-sm text-gray-300">
                                        同じネットワーク内なら<br>どのポートでも通信OK
                                    </p>
                                </div>
                            </div>

                            <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-6">
                                <div class="font-bold text-yellow-300 mb-3">だからDBのポートを開けなくていい</div>
                                <div class="bg-slate-800/50 p-4 rounded font-mono text-sm">
                                    <div class="text-gray-400"># docker-compose.yml</div>
                                    <div>services:</div>
                                    <div>&nbsp;&nbsp;db:</div>
                                    <div>&nbsp;&nbsp;&nbsp;&nbsp;image: mysql:8.0</div>
                                    <div class="text-gray-500">&nbsp;&nbsp;&nbsp;&nbsp;# ports: は書かない！</div>
                                    <div>&nbsp;&nbsp;&nbsp;&nbsp;# → 外部からはアクセス不可（安全）</div>
                                    <div>&nbsp;&nbsp;&nbsp;&nbsp;# → アプリからは db:3306 でアクセス可能</div>
                                </div>
                                <p class="text-sm text-gray-300 mt-4">
                                    DBに外部からアクセスされたくないですよね。<br>
                                    ポートを開けなければ、アプリだけがアクセスできます。
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Docker Compose なら自動 -->
                    <div class="content-section">
                        <h3>🐳 Docker Compose なら自動</h3>
                        <div class="collapsible-content">
                            <p class="text-lg mb-6">
                                ここまで手動でネットワークを作りましたが、<br>
                                <strong>Docker Compose を使えば自動</strong>です。
                            </p>

                            <div class="bg-slate-700/30 p-6 rounded-xl mb-6">
                                <div class="font-bold text-lg mb-4">Docker Compose がやってくれること</div>

                                <div class="bg-slate-800/50 p-4 rounded font-mono text-sm mb-4">
                                    <div class="text-gray-400"># docker-compose.yml</div>
                                    <div>services:</div>
                                    <div>&nbsp;&nbsp;app:</div>
                                    <div>&nbsp;&nbsp;&nbsp;&nbsp;build: .</div>
                                    <div>&nbsp;&nbsp;db:</div>
                                    <div>&nbsp;&nbsp;&nbsp;&nbsp;image: mysql:8.0</div>
                                </div>

                                <div class="space-y-3">
                                    <div class="flex items-start">
                                        <span class="text-green-400 mr-3">✓</span>
                                        <span>自動でネットワークを作成（<code>プロジェクト名_default</code>）</span>
                                    </div>
                                    <div class="flex items-start">
                                        <span class="text-green-400 mr-3">✓</span>
                                        <span>全サービスを同じネットワークに接続</span>
                                    </div>
                                    <div class="flex items-start">
                                        <span class="text-green-400 mr-3">✓</span>
                                        <span>サービス名でDNS解決（<code>app</code> → <code>db</code> で通信可能）</span>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-6 mb-6">
                                <div class="font-bold text-green-300 mb-3">だから db と書くだけで繋がる</div>
                                <div class="bg-slate-800/50 p-4 rounded font-mono text-sm">
                                    <div class="text-gray-400"># .env や環境変数で</div>
                                    <div>DB_HOST=db</div>
                                    <div>DB_PORT=3306</div>
                                    <div></div>
                                    <div class="text-gray-400"># PHPからの接続</div>
                                    <div>$pdo = new PDO('mysql:host=db;port=3306;...');</div>
                                </div>
                                <p class="text-sm text-gray-300 mt-4">
                                    <code>localhost</code> ではなく <code>db</code>（サービス名）を使います。
                                </p>
                            </div>

                            <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-6">
                                <div class="font-bold text-blue-300 mb-3">ネットワークを確認してみよう</div>
                                <div class="command-box mb-4">
                                    <div class="command"># docker compose up した後に実行</div>
                                    <div class="command">docker network ls</div>
                                    <div class="output">
NETWORK ID     NAME                    DRIVER    SCOPE
a1b2c3d4e5f6   bridge                  bridge    local
f6e5d4c3b2a1   myproject_default       bridge    local  ← 自動作成された！
                                    </div>
                                </div>
                                <p class="text-sm text-gray-300">
                                    <code>プロジェクト名_default</code> というネットワークが自動で作られています。
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- まとめ -->
                    <div class="content-section">
                        <h3>🎯 まとめ</h3>
                        <div class="collapsible-content">

                            <div class="bg-slate-700/30 p-6 rounded-xl mb-6">
                                <div class="text-xl font-bold text-center mb-6">Dockerネットワークの本質</div>

                                <div class="space-y-6">
                                    <div class="flex items-start">
                                        <div class="bg-red-500 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold mr-4 flex-shrink-0">1</div>
                                        <div>
                                            <div class="font-bold text-lg">コンテナは孤立している</div>
                                            <p class="text-gray-300">localhost は自分自身。他のコンテナには届かない。</p>
                                        </div>
                                    </div>

                                    <div class="flex items-start">
                                        <div class="bg-green-500 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold mr-4 flex-shrink-0">2</div>
                                        <div>
                                            <div class="font-bold text-lg">同じネットワーク = サービス名で通信</div>
                                            <p class="text-gray-300">ネットワークに入れると、名前で繋がる。IPアドレス不要。</p>
                                        </div>
                                    </div>

                                    <div class="flex items-start">
                                        <div class="bg-blue-500 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold mr-4 flex-shrink-0">3</div>
                                        <div>
                                            <div class="font-bold text-lg">Docker Compose なら自動</div>
                                            <p class="text-gray-300">ネットワーク作成・接続・DNS解決、全部やってくれる。</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-6 mb-6">
                                <div class="font-bold text-yellow-300 mb-3">よくある間違い（.env）</div>
                                <div class="bg-slate-800/50 p-4 rounded font-mono text-sm">
                                    <div class="text-red-400"># ❌ これは動かない</div>
                                    <div class="text-red-400">DB_HOST=localhost</div>
                                    <div class="mt-3"></div>
                                    <div class="text-green-400"># ✅ サービス名を使う</div>
                                    <div class="text-green-400">DB_HOST=db</div>
                                </div>
                            </div>

                            <div class="success-box">
                                <h4>✅ 理解できたこと</h4>
                                <ul>
                                    <li>コンテナは独立したネットワーク空間を持つ</li>
                                    <li>同じネットワークに入れるとサービス名で通信できる</li>
                                    <li>Docker Compose はネットワークを自動管理する</li>
                                    <li>外部には ports: で明示的に公開する</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </main>
    </div>
    <script src="course-config.js"></script>
    <script src="../js/header.js"></script>
    <script src="../js/sidebar.js"></script>
    <script src="../js/footer.js"></script>
    <script src="js/docker-common.js"></script>
</body>
</html>
