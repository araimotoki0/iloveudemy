<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>【第四弾】Laravel入門資料</title>
    <meta name="description" content="【第四弾】Laravel入門の補足資料とリソース集">

    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🐳</text></svg>">

    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&family=Noto+Sans+JP:wght@300;400;500;700;900&family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f7ff',
                            100: '#e0eeff',
                            200: '#c0ddff',
                            300: '#8cc3ff',
                            400: '#5aa3ff',
                            500: '#3183ff',
                            600: '#1a6cf5',
                            700: '#1455e0',
                            800: '#1747b5',
                            900: '#193d8f',
                        },
                    },
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans JP', 'Montserrat', 'sans-serif'],
                        mont: ['Montserrat', 'sans-serif'],
                        inter: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/styles/atom-one-dark.min.css">
    <style>
        body {
            overflow-x: hidden;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            background-attachment: fixed;
        }
        .content-section {
            margin-bottom: 32px;
        }

        .content-section h3 {
            color: #3183ff;
            margin-bottom: 16px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            border-radius: 8px;
            transition: background 0.2s ease;
        }

        .content-section h3:hover {
            background: rgba(49, 131, 255, 0.1);
        }

        .content-section h3::after {
            content: '▼';
            font-size: 16px;
            transition: transform 0.3s ease;
            flex-shrink: 0;
            margin-left: 12px;
        }

        .content-section h3.collapsed::after {
            transform: rotate(-90deg);
        }

        .collapsible-content {
            max-height: 10000px;
            overflow: hidden;
            transition: max-height 0.5s ease, opacity 0.3s ease;
            opacity: 1;
        }

        .collapsible-content.collapsed {
            max-height: 0;
            opacity: 0;
        }

        .content-section h4 {
            color: #8b5cf6;
            margin: 20px 0 12px;
            font-size: 18px;
            font-weight: bold;
        }

        .content-section h5 {
            color: #10b981;
            margin: 16px 0 10px;
            font-size: 16px;
            font-weight: bold;
        }

        .content-section p {
            margin: 12px 0;
            line-height: 1.8;
            color: #d1d5db;
        }

        .content-section ul,
        .content-section ol {
            margin: 12px 0;
            padding-left: 24px;
            color: #d1d5db;
        }

        .content-section li {
            margin: 8px 0;
            line-height: 1.6;
        }

        .content-section a {
            color: #3183ff;
            text-decoration: underline;
        }

        .content-section a:hover {
            color: #8b5cf6;
        }

        .content-section strong {
            color: #fff;
            font-weight: 600;
        }

        pre {
            position: relative;
            margin: 16px 0;
            border-radius: 8px;
            overflow: hidden;
        }

        pre code {
            font-size: 14px;
            line-height: 1.6;
        }

        .copy-button {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: #fff;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .copy-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        table {
            border-collapse: collapse;
        }

        table th,
        table td {
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>

<body class="text-white font-inter">
    <!-- サイドバーはsidebar.jsで生成されます -->

    <!-- 目次ポップアップ（コンパクト版） -->
    <div id="toc-modal" class="fixed top-32 right-8 z-50 hidden">
        <div class="glass-dark rounded-lg p-4 w-80 max-h-[70vh] overflow-y-auto shadow-2xl">
            <div class="flex justify-between items-center mb-3">
                <h2 class="text-sm font-bold text-white">
                    目次
                </h2>
                <button id="close-toc" class="text-gray-400 hover:text-white transition-colors">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="toc-list" class="space-y-1">
                <!-- 目次項目はJavaScriptで動的に生成 -->
            </div>
        </div>
    </div>

    <!-- 上に戻るボタン -->
    <button id="scroll-to-top"
        class="fixed bottom-8 right-8 w-12 h-12 bg-gradient-to-r from-primary-500 to-purple-500 text-white rounded-full shadow-2xl opacity-0 pointer-events-none transition-all duration-300 hover:scale-110 z-50 flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
        </svg>
    </button>

    <div class="min-h-screen flex flex-col">

        <!-- 目次ボタンと全て閉じるボタン（固定位置） -->
        <div class="fixed top-24 right-16 z-40 flex flex-col gap-2">
            <button id="toc-button"
                class="px-3 py-1.5 rounded-lg glass hover:bg-white/20 transition-colors duration-200 flex items-center gap-2">
                <svg class="h-4 w-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
                </svg>
                <span class="text-white text-xs">目次</span>
            </button>
            <button id="toggle-all" class="px-3 py-1.5 rounded-lg bg-red-500/20 hover:bg-red-500/30 transition-colors duration-200 flex items-center justify-center gap-2 text-xs text-red-300 hover:text-red-200 border border-red-500/30">
                <svg id="toggle-icon" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
                <span id="toggle-text" class="text-white text-xs">全て閉じる</span>
            </button>
        </div>

        <!-- メインコンテンツ -->
        <main class="flex-grow py-16 px-4 sm:px-6 lg:px-8">
            <div class="max-w-6xl mx-auto">
                <h1
                    class="text-3xl md:text-4xl font-black mb-8 text-center bg-gradient-to-r from-primary-400 to-purple-400 bg-clip-text text-transparent">
                    【第四弾】Laravel入門資料
                </h1>

                <!-- タブリスト -->
                <ul class="flex flex-wrap gap-2 mb-6">
                    <li><a href="course-introduction.html" class="block px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-sm transition-colors">コース紹介</a></li>
                    <li><a href="setup-windows.html" class="block px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-sm transition-colors">Windows環境構築</a></li>
                    <li><a href="setup.html" class="block px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-sm transition-colors">Mac環境構築</a></li>
                    <li><a href="index.html" class="block px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-sm transition-colors">Laravelとは</a></li>
                    <li><a href="routing.html" class="block px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-sm transition-colors">ルーティング</a></li>
                    <li><a href="view.html" class="block px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-sm transition-colors">ビュー</a></li>
                    <li><a href="controller.html" class="block px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-sm transition-colors">コントローラ</a></li>
                    <li><a href="migration.html" class="block px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-sm transition-colors">マイグレーション</a></li>
                    <li><a href="model.html" class="block px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-sm transition-colors">モデル</a></li>
                    <li><a href="database-practice.html" class="block px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-sm transition-colors">ここまでの知識の実践</a></li>
                    <li><a href="search-filter.html" class="block px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-sm transition-colors">検索・フィルタ</a></li>
                    <li><a href="soft-delete.html" class="block px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-sm transition-colors">ソフトデリート</a></li>
                    <li><a href="pagination.html" class="block px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-sm transition-colors">ページネーション</a></li>
                    <li><a href="image-upload.html" class="block px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-sm transition-colors">画像アップロード</a></li>
                    <li><a href="authentication.html" class="block px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-sm transition-colors">認証ライブラリ</a></li>
                    <li><a href="authentication-implementation.html" class="block px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-sm transition-colors">認証実装</a></li>
                    <li><a href="authentication-middleware.html" class="block px-4 py-2 bg-gradient-to-r from-primary-500 to-purple-500 rounded-lg text-sm">ミドルウェア・ロール</a></li>
                    <li><a href="comprehensive-practice.html" class="block px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-sm transition-colors">総合実践</a></li>
                </ul>

                <!-- コンテンツ -->
                <div class="glass rounded-3xl p-8">
                    <!-- 公式ドキュメントへのリンク -->
                    <div class="glass-dark p-6 rounded-xl mb-8 border-l-4 border-primary-500">
                        <p class="text-lg mb-3">
                            📚 <strong>Laravel公式ドキュメント - Middleware / Authorization</strong>
                        </p>
                        <a href="https://laravel.com/docs/12.x/middleware" target="_blank"
                           class="text-primary-400 hover:text-primary-300 underline text-base block mb-2">
                            https://laravel.com/docs/12.x/middleware
                        </a>
                        <a href="https://laravel.com/docs/12.x/authorization" target="_blank"
                           class="text-primary-400 hover:text-primary-300 underline text-base block">
                            https://laravel.com/docs/12.x/authorization
                        </a>
                        <p class="text-gray-400 text-sm mt-4 leading-relaxed">
                            💡 この講座では、上記の公式ドキュメントを基に解説していきます。<br>
                            公式ドキュメントは初学者には内容が難しいため、エッセンスを優しく噛み砕いて解説していきます。
                        </p>
                    </div>

                    <div class="content-section">
                        <h3>ミドルウェアと権限管理</h3>
                        <p>
                            認証機能だけでは不十分です。<strong class="text-yellow-300">誰が何をできるか</strong>を管理する<strong class="text-yellow-300">権限管理（認可）</strong>が必要です。<br>
                            この章では、ミドルウェアとロールを使った権限管理を学びます。
                        </p>
                    </div>

                    <div class="content-section">
                        <h3>認証と認可の違い</h3>

                        <p class="text-gray-300 mb-4">
                            前章で学んだのは<strong class="text-yellow-300">認証（Authentication）</strong>です。<br>
                            この章で学ぶのは<strong class="text-yellow-300">認可（Authorization）</strong>です。
                        </p>

                        <div class="bg-gray-800 p-4 rounded-lg mb-6 border-l-4 border-blue-500">
                            <p class="text-gray-300 mb-2"><strong class="text-blue-300">認証（Authentication）</strong></p>
                            <p class="text-gray-300 text-sm">
                                <strong class="text-yellow-300">「あなたは誰ですか？」</strong>を確認すること。<br>
                                ログイン機能がこれにあたります。
                            </p>
                            <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mt-3"><code class="language-php">// 認証：ログインしているか確認
if (auth()->check()) {
    echo 'ログインしています';
}

// 誰がログインしているか
echo auth()->user()->name;  // 「田中太郎」</code></pre>
                        </div>

                        <div class="bg-gray-800 p-4 rounded-lg mb-6 border-l-4 border-purple-500">
                            <p class="text-gray-300 mb-2"><strong class="text-purple-300">認可（Authorization）</strong></p>
                            <p class="text-gray-300 text-sm">
                                <strong class="text-yellow-300">「あなたには権限がありますか？」</strong>を確認すること。<br>
                                管理者のみアクセス可能なページを作る機能がこれにあたります。
                            </p>
                            <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mt-3"><code class="language-php">// 認可：管理者権限を持っているか確認
if (auth()->user()->isAdmin()) {
    echo '管理者です';
}

// 特定のロールを持っているか
if (auth()->user()->hasRole('admin')) {
    echo '管理者権限があります';
}</code></pre>
                        </div>

                        <h4 class="text-xl font-bold text-green-400 mb-3">具体例で理解しよう</h4>
                        <div class="bg-gray-800 p-4 rounded-lg mb-6">
                            <p class="text-gray-300 mb-2"><strong class="text-yellow-300">会社のオフィスに例えると:</strong></p>
                            <ul class="list-disc ml-6 text-gray-300 space-y-2 text-sm">
                                <li>
                                    <strong class="text-blue-300">認証</strong>: 社員証でゲートを通る<br>
                                    <span class="text-gray-400 ml-4">→ 「あなたは社員である」ことを確認</span>
                                </li>
                                <li>
                                    <strong class="text-purple-300">認可</strong>: 役職によって入れる部屋が異なる<br>
                                    <span class="text-gray-400 ml-4">→ 「一般社員は会議室Aにアクセスできるが、役員会議室には入れない」</span>
                                </li>
                            </ul>
                        </div>

                        <h4 class="text-xl font-bold text-green-400 mb-3">Webアプリケーションの例</h4>
                        <div class="bg-gray-800 p-4 rounded-lg mb-6">
                            <table class="text-xs mt-3 w-full">
                                <thead>
                                    <tr class="border-b border-gray-600">
                                        <th class="text-left pb-2 text-blue-300 px-2">ページ</th>
                                        <th class="text-left pb-2 text-blue-300 px-2">認証</th>
                                        <th class="text-left pb-2 text-blue-300 px-2">認可</th>
                                    </tr>
                                </thead>
                                <tbody class="text-gray-300">
                                    <tr class="border-b border-gray-700">
                                        <td class="py-2 px-2">トップページ</td>
                                        <td class="py-2 px-2">不要</td>
                                        <td class="py-2 px-2">不要</td>
                                    </tr>
                                    <tr class="border-b border-gray-700">
                                        <td class="py-2 px-2">ダッシュボード</td>
                                        <td class="py-2 px-2"><strong class="text-yellow-300">必要</strong>（ログイン必須）</td>
                                        <td class="py-2 px-2">不要</td>
                                    </tr>
                                    <tr class="border-b border-gray-700">
                                        <td class="py-2 px-2">記事編集</td>
                                        <td class="py-2 px-2"><strong class="text-yellow-300">必要</strong>（ログイン必須）</td>
                                        <td class="py-2 px-2"><strong class="text-yellow-300">必要</strong>（編集者または管理者）</td>
                                    </tr>
                                    <tr>
                                        <td class="py-2 px-2">ユーザー管理</td>
                                        <td class="py-2 px-2"><strong class="text-yellow-300">必要</strong>（ログイン必須）</td>
                                        <td class="py-2 px-2"><strong class="text-yellow-300">必要</strong>（管理者のみ）</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <p class="text-green-300 mt-4">
                            ✅ 認証と認可の違いが理解できました！
                        </p>
                    </div>

                    <div class="content-section">
                        <h3>ミドルウェアの仕組み</h3>

                        <p class="text-gray-300 mb-4">
                            ミドルウェアは、<strong class="text-yellow-300">コントローラーが実行される前</strong>にチェックを行う「番人」のような仕組みです。
                        </p>

                        <h4 class="text-xl font-bold text-green-400 mb-3">ミドルウェアファイルの構造</h4>
                        <p class="text-gray-300 mb-3 text-sm">
                            まず、ミドルウェアファイルがどう書かれているか見てみましょう。
                        </p>

                        <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mb-4"><code class="language-php">// app/Http/Middleware/Authenticate.php (Laravel標準のミドルウェア)

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;

class Authenticate
{
    public function handle(Request $request, Closure $next)
    {
        // ログインしているかチェック
        if (!auth()->check()) {
            // ログインしていない → ログインページへリダイレクト
            return redirect('/login');
        }

        // ログインしている → 次の処理(コントローラー)へ進む
        return $next($request);
    }
}</code></pre>

                        <div class="bg-gray-800 p-4 rounded-lg mb-6 border-l-4 border-blue-500">
                            <p class="text-sm font-bold text-blue-300 mb-2">📝 コードの構造</p>
                            <ul class="text-xs text-gray-300 space-y-2 ml-3">
                                <li>• <strong>ミドルウェアは必ず <code>handle()</code> メソッドを持つ</strong></li>
                                <li>• 第1引数 <code>$request</code>: ユーザーからのリクエスト情報</li>
                                <li>• 第2引数 <code>$next</code>: 次の処理(コントローラー)を実行する関数</li>
                            </ul>
                        </div>

                        <h4 class="text-xl font-bold text-green-400 mb-3">$next($request) の意味</h4>
                        <div class="bg-gray-800 p-4 rounded-lg mb-6">
                            <p class="text-gray-300 mb-2"><strong class="text-yellow-300">ミドルウェアの2つの選択肢:</strong></p>
                            <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto text-sm"><code>ユーザーがアクセス
   ↓
[ミドルウェアの handle() メソッドが実行される]
   ↓
条件チェック
   ↓
✅ OK → return $next($request);     ← コントローラーへ進む
❌ NG → return redirect('/login');  ← ここで処理を止める</code></pre>
                        </div>

                        <div class="bg-blue-900/30 p-4 rounded-lg mb-6 border-l-4 border-blue-400">
                            <p class="text-sm font-bold text-blue-300 mb-2">💡 重要ポイント</p>
                            <ul class="text-xs text-gray-300 space-y-2 ml-3">
                                <li>• <code>return $next($request);</code> → <strong>次の処理(コントローラー)へ進む</strong></li>
                                <li>• <code>return redirect();</code> → <strong>処理を止めてリダイレクト</strong></li>
                                <li>• <code>return abort(403);</code> → <strong>処理を止めてエラー表示</strong></li>
                            </ul>

                            <div class="bg-gray-900/50 p-3 rounded mt-3">
                                <p class="text-xs text-gray-400 mb-1"><strong>なぜ $next を使うの？</strong></p>
                                <p class="text-xs text-gray-300">
                                    Laravelのミドルウェアは必ず <code>$next($request)</code> を使う設計です。<br>
                                    これは「次に何が実行されるか(別のミドルウェアかコントローラーか)をミドルウェア自身は知らない」ためです。<br>
                                    <code>$next($request)</code> で次に渡すのが標準的な書き方です。
                                </p>
                            </div>
                        </div>

                        <h4 class="text-xl font-bold text-green-400 mb-3">具体例: 管理者チェックのミドルウェア</h4>
                        <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mb-4"><code class="language-php">// app/Http/Middleware/IsAdmin.php

class IsAdmin
{
    public function handle(Request $request, Closure $next)
    {
        // 1. ログインしているかチェック
        if (!auth()->check()) {
            return redirect('/login');  // ← ここで止まる
        }

        // 2. 管理者かチェック
        if (!auth()->user()->isAdmin()) {
            return abort(403);  // ← ここで止まる
        }

        // 3. 両方OKならコントローラーへ
        return $next($request);  // ← コントローラー実行
    }
}</code></pre>

                        <div class="bg-gray-800 p-4 rounded-lg mb-6 border-l-4 border-green-500">
                            <p class="text-xs text-gray-300 mb-2"><strong class="text-green-300">📝 補足: レスポンス後の処理も可能</strong></p>
                            <p class="text-xs text-gray-300 mb-2">
                                ミドルウェアはレスポンスを返した後の処理も書けます（例: アクセスログの記録）。<br>
                                ただし今回は使わないので、「リクエスト前のチェック」だけ覚えておけばOKです。
                            </p>
                            <pre class="bg-gray-900 p-3 rounded text-xs mt-2"><code class="language-php">public function handle(Request $request, Closure $next)
{
    // リクエスト前の処理（今回使う）

    $response = $next($request);  // コントローラー実行

    // レスポンス後の処理（今回は使わない）
    // 例: Log::info('アクセスログ');

    return $response;
}</code></pre>
                        </div>

                        <h4 class="text-xl font-bold text-green-400 mb-3">Laravelの標準ミドルウェア</h4>
                        <div class="bg-gray-800 p-4 rounded-lg mb-6">
                            <table class="text-xs mt-3 w-full">
                                <thead>
                                    <tr class="border-b border-gray-600">
                                        <th class="text-left pb-2 text-blue-300 px-2">ミドルウェア</th>
                                        <th class="text-left pb-2 text-blue-300 px-2">役割</th>
                                    </tr>
                                </thead>
                                <tbody class="text-gray-300">
                                    <tr class="border-b border-gray-700">
                                        <td class="py-2 px-2"><code>auth</code></td>
                                        <td class="py-2 px-2">ログインしているかチェック（認証）</td>
                                    </tr>
                                    <tr class="border-b border-gray-700">
                                        <td class="py-2 px-2"><code>guest</code></td>
                                        <td class="py-2 px-2">ログインしていないかチェック</td>
                                    </tr>
                                    <tr class="border-b border-gray-700">
                                        <td class="py-2 px-2"><code>verified</code></td>
                                        <td class="py-2 px-2">メール認証済みかチェック</td>
                                    </tr>
                                    <tr>
                                        <td class="py-2 px-2"><code>throttle</code></td>
                                        <td class="py-2 px-2">レート制限（アクセス回数制限）</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <h4 class="text-xl font-bold text-green-400 mb-3">authミドルウェアの使い方</h4>
                        <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mb-6"><code class="language-php">// routes/web.php

// 方法1: 個別のルートに適用
Route::get('/dashboard', [DashboardController::class, 'index'])
    ->middleware('auth');

// 方法2: 複数のルートにまとめて適用
Route::middleware(['auth'])->group(function () {
    Route::get('/dashboard', [DashboardController::class, 'index']);
    Route::get('/profile', [ProfileController::class, 'show']);
    Route::get('/settings', [SettingsController::class, 'index']);
});

// 方法3: コントローラーで適用
class DashboardController extends Controller
{
    public function __construct()
    {
        $this->middleware('auth');
    }

    public function index()
    {
        return view('dashboard');
    }
}</code></pre>

                        <div class="bg-gray-800 p-4 rounded-lg mb-6 border-l-4 border-blue-500">
                            <p class="text-gray-300 mb-2"><strong class="text-blue-300">authミドルウェアの動き:</strong></p>
                            <ul class="list-disc ml-6 text-gray-300 space-y-1 text-sm">
                                <li>ログインしている → コントローラー処理を続行</li>
                                <li>ログインしていない → <code>/login</code> にリダイレクト</li>
                            </ul>
                        </div>

                        <p class="text-green-300 mt-4">
                            ✅ ミドルウェアの仕組みが理解できました！
                        </p>
                    </div>

                    <div class="content-section">
                        <h3>ロールテーブルの設計</h3>

                        <p class="text-gray-300 mb-4">
                            まずは、<strong class="text-yellow-300">usersテーブルにroleカラムを追加</strong>するシンプルな方法を学びます。
                        </p>

                        <h4 class="text-xl font-bold text-green-400 mb-3">ステップ1: マイグレーション作成</h4>
                        <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mb-6"><code class="language-bash"># マイグレーション作成
php artisan make:migration add_role_to_users_table</code></pre>

                        <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mb-6"><code class="language-php">// database/migrations/xxxx_add_role_to_users_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::table('users', function (Blueprint $table) {
            $table->enum('role', ['admin', 'user'])->default('user')->after('name');
        });
    }

    public function down(): void
    {
        Schema::table('users', function (Blueprint $table) {
            $table->dropColumn('role');
        });
    }
};</code></pre>

                        <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mb-6"><code class="language-bash"># マイグレーション実行
php artisan migrate</code></pre>

                        <div class="bg-gray-800 p-4 rounded-lg mb-6 border-l-4 border-blue-500">
                            <p class="text-gray-300 mb-2"><strong class="text-blue-300">想定するロール:</strong></p>
                            <ul class="list-disc ml-6 text-gray-300 space-y-1 text-sm">
                                <li><code class="text-blue-300">'user'</code> - 一般ユーザー（デフォルト）</li>
                                <li><code class="text-blue-300">'admin'</code> - 管理者（全ての操作が可能）</li>
                            </ul>
                        </div>

                        <h4 class="text-xl font-bold text-green-400 mb-3">ステップ2: Userモデルにメソッド追加</h4>
                        <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mb-6"><code class="language-php">// app/Models/User.php

class User extends Authenticatable
{
    protected $fillable = [
        'name',
        'email',
        'password',
        'role',  // ← 追加
    ];

    /**
     * 管理者かどうか
     */
    public function isAdmin(): bool
    {
        return $this->role === 'admin';
    }

    /**
     * 特定のロールを持っているかチェック
     */
    public function hasRole(string $role): bool
    {
        return $this->role === $role;
    }

    /**
     * いずれかのロールを持っているかチェック
     */
    public function hasAnyRole(array $roles): bool
    {
        return in_array($this->role, $roles);
    }
}</code></pre>

                        <h4 class="text-xl font-bold text-green-400 mb-3">ステップ3: Tinkerでロールを設定してみよう</h4>
                        <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mb-6"><code class="language-bash"># Tinkerを起動
php artisan tinker</code></pre>

                        <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mb-6"><code class="language-php">// ユーザーを取得
$user = User::find(1);

// 現在のロールを確認
$user->role;
// => "user"（デフォルト）

// 管理者に昇格
$user->role = 'admin';
$user->save();

// 管理者かどうか確認
$user->isAdmin();
// => true

$user->hasRole('admin');
// => true

// 一般ユーザーを作成
$normalUser = User::create([
    'name' => '一般ユーザー',
    'email' => 'user@example.com',
    'password' => 'password',
    'role' => 'user',  // デフォルトは'user'なので省略可
]);

$normalUser->isAdmin();
// => false

$normalUser->hasRole('user');
// => true</code></pre>

                        <div class="bg-gray-800 p-4 rounded-lg mb-6 border-l-4 border-green-500">
                            <p class="text-gray-300 mb-2"><strong class="text-green-300">✅ Tinkerで確認したこと:</strong></p>
                            <ul class="list-disc ml-6 text-gray-300 space-y-1 text-sm">
                                <li>ロールの変更と保存</li>
                                <li>isAdmin()での判定</li>
                                <li>hasRole()での特定ロールチェック</li>
                                <li>hasAnyRole()での複数ロールチェック</li>
                            </ul>
                        </div>

                        <p class="text-green-300 mt-4">
                            ✅ シンプルなロール管理が実装できました！
                        </p>
                    </div>

                    <div class="content-section">
                        <h3>カスタムミドルウェアの作成</h3>

                        <p class="text-gray-300 mb-4">
                            <strong class="text-yellow-300">管理者のみアクセス可能</strong>なページを作るため、カスタムミドルウェアを作成します。
                        </p>

                        <h4 class="text-xl font-bold text-green-400 mb-3">ステップ1: ミドルウェア作成</h4>
                        <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mb-6"><code class="language-bash"># ミドルウェア作成
php artisan make:middleware IsAdmin</code></pre>

                        <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mb-6"><code class="language-php">// app/Http/Middleware/IsAdmin.php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;

class IsAdmin
{
    /**
     * Handle an incoming request.
     */
    public function handle(Request $request, Closure $next): Response
    {
        // ログインしているか確認
        if (!auth()->check()) {
            return redirect('/login');
        }

        // 管理者かどうか確認
        if (!auth()->user()->isAdmin()) {
            abort(403, 'このページにアクセスする権限がありません。');
        }

        // 管理者なら次の処理へ
        return $next($request);
    }
}</code></pre>

                        <div class="bg-gray-800 p-4 rounded-lg mb-6 border-l-4 border-yellow-500">
                            <p class="text-gray-300 mb-2"><strong class="text-yellow-300">ミドルウェアの動き:</strong></p>
                            <ol class="list-decimal ml-6 text-gray-300 space-y-1 text-sm">
                                <li>ログインしていない → <code>/login</code> にリダイレクト</li>
                                <li>ログインしているが管理者ではない → 403エラー（Forbidden）</li>
                                <li>管理者 → 次の処理（コントローラー）へ</li>
                            </ol>
                        </div>

                        <h4 class="text-xl font-bold text-green-400 mb-3">ステップ2: ミドルウェアを登録</h4>
                        <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mb-6"><code class="language-php">// bootstrap/app.php (Laravel 12)

use App\Http\Middleware\IsAdmin;
use Illuminate\Foundation\Application;
use Illuminate\Foundation\Configuration\Exceptions;
use Illuminate\Foundation\Configuration\Middleware;

return Application::configure(basePath: dirname(__DIR__))
    ->withRouting(
        web: __DIR__.'/../routes/web.php',
        commands: __DIR__.'/../routes/console.php',
        health: '/up',
    )
    ->withMiddleware(function (Middleware $middleware): void {
        // ミドルウェアのエイリアスを登録
        $middleware->alias([
            'admin' => IsAdmin::class,
        ]);
    })
    ->withExceptions(function (Exceptions $exceptions): void {
        //
    })->create();</code></pre>

                        <div class="glass-dark p-4 rounded-xl mt-3 border-l-4 border-purple-500">
                            <p class="text-xs"><strong>💡 ポイント</strong></p>
                            <ul class="text-xs text-gray-300 ml-3 mt-2 space-y-1">
                                <li>• Laravel 11以降は <code>bootstrap/app.php</code> の <code>withMiddleware()</code> でミドルウェアを登録します</li>
                                <li>• <code>$middleware->alias()</code> で短い名前(例: 'admin')とクラスを紐づけます</li>
                                <li>• ルートで <code>->middleware('admin')</code> と書くことで適用できます</li>
                            </ul>
                        </div>

                        <h4 class="text-xl font-bold text-green-400 mb-3">ステップ3: ルートに適用</h4>
                        <p class="text-gray-300 mb-3 text-sm">
                            認証セクションで作成した <code>dashboard</code> ルートを管理者専用に改修します。
                        </p>

                        <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mb-6"><code class="language-php">// routes/web.php

// 管理者専用ページ (adminミドルウェアでグループ化)
Route::middleware(['admin'])->group(function () {
    Route::get('/dashboard', function () {
        return view('dashboard');
    })->name('dashboard');
});</code></pre>

                        <div class="bg-gray-800 p-4 rounded-lg mb-6 border-l-4 border-blue-500">
                            <p class="text-gray-300 mb-2"><strong class="text-blue-300">ポイント:</strong></p>
                            <ul class="list-disc ml-6 text-gray-300 space-y-1 text-sm">
                                <li><code>middleware(['admin'])->group()</code> でグループ化すると、複数のルートにまとめて適用できる</li>
                                <li>認証セクションで作成したdashboardルートを管理者専用に変更</li>
                                <li>adminミドルウェア内でログインチェックもしているので、<code>'auth'</code> は不要</li>
                            </ul>

                            <div class="bg-gray-900/50 p-3 rounded mt-3">
                                <p class="text-xs text-gray-400 mb-1"><strong>💡 複数のミドルウェアも設定可能</strong></p>
                                <p class="text-xs text-gray-300 mb-2">
                                    今回は<code>['admin']</code>だけですが、複数のミドルウェアも指定できます:
                                </p>
                                <pre class="text-xs bg-gray-800 p-2 rounded"><code class="language-php">// 複数のミドルウェアを適用する例
Route::middleware(['auth', 'verified', 'admin'])->group(function () {
    // このグループ内のルートは3つのミドルウェアを通過する
});</code></pre>
                                <p class="text-xs text-gray-400 mt-2">
                                    配列の順番通りに実行されます。今回は必要ないので覚えておくだけでOKです。
                                </p>
                            </div>
                        </div>

                        <h4 class="text-xl font-bold text-green-400 mb-3">実践: 実際にアクセスしてテストしてみよう</h4>

                        <p class="text-sm font-bold text-purple-300 mb-3">ステップ1: Tinkerでユーザーを作成</p>
                        <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mb-4"><code class="language-bash">php artisan tinker</code></pre>

                        <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mb-4"><code class="language-php">// 管理者を作成
User::create([
    'name' => '管理者',
    'email' => 'admin@example.com',
    'password' => bcrypt('password'),
    'role' => 'admin',
]);

// 一般ユーザーを作成
User::create([
    'name' => '一般ユーザー',
    'email' => 'user@example.com',
    'password' => bcrypt('password'),
    'role' => 'user',
]);</code></pre>

                        <p class="text-sm font-bold text-purple-300 mb-3">ステップ2: ブラウザでアクセスして確認</p>
                        <div class="bg-gray-800 p-4 rounded-lg mb-4 border-l-4 border-green-500">
                            <p class="text-xs text-gray-300 mb-2">1️⃣ 管理者でログイン</p>
                            <ul class="text-xs text-gray-300 ml-4 space-y-1 mb-3">
                                <li>• <code>http://localhost/login</code> にアクセス</li>
                                <li>• Email: <code>admin@example.com</code></li>
                                <li>• Password: <code>password</code></li>
                            </ul>

                            <p class="text-xs text-gray-300 mb-2">2️⃣ ダッシュボードにアクセス</p>
                            <ul class="text-xs text-gray-300 ml-4 space-y-1 mb-3">
                                <li>• ログイン後、自動的に <code>http://localhost/dashboard</code> へリダイレクト</li>
                                <li>• <strong class="text-green-300">✅ 管理者なのでアクセスできる!</strong></li>
                            </ul>

                            <p class="text-xs text-gray-300 mb-2">3️⃣ ログアウトして一般ユーザーでログイン</p>
                            <ul class="text-xs text-gray-300 ml-4 space-y-1">
                                <li>• Email: <code>user@example.com</code></li>
                                <li>• ログイン後、<code>http://localhost/dashboard</code> へ自動リダイレクト</li>
                                <li>• <strong class="text-red-300">❌ 403エラー表示!</strong> (一般ユーザーはアクセスできない)</li>
                            </ul>
                        </div>

                        <div class="bg-blue-900/30 p-4 rounded-lg mb-6 border-l-4 border-blue-400">
                            <p class="text-sm font-bold text-blue-300 mb-2">🎓 何が起きたか？</p>
                            <ul class="text-xs text-gray-300 space-y-2 ml-3">
                                <li>✅ 管理者: <code>isAdmin()</code> が <code>true</code> → ミドルウェア通過 → ページ表示</li>
                                <li>❌ 一般ユーザー: <code>isAdmin()</code> が <code>false</code> → ミドルウェアで <code>abort(403)</code> → エラー画面</li>
                            </ul>
                        </div>

                        <p class="text-green-300 mt-4">
                            ✅ カスタムミドルウェアで権限管理ができました！
                        </p>
                    </div>


                    <div class="content-section">
                        <h3>一般ユーザー用の画面を作成</h3>

                        <p class="text-gray-300 mb-4">
                            管理者以外の一般ユーザーもログイン後にアクセスできる画面を作成しましょう。
                        </p>

                        <h4 class="text-xl font-bold text-green-400 mb-3">ステップ1: 一般ユーザー用ビューの作成</h4>
                        <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mb-4"><code class="language-html">&lt;!-- resources/views/home.blade.php --&gt;
&lt;h1&gt;ホーム画面&lt;/h1&gt;
&lt;p&gt;ようこそ、{{ auth()->user()->name }}さん&lt;/p&gt;
&lt;p&gt;あなたは一般ユーザーです。&lt;/p&gt;</code></pre>

                        <h4 class="text-xl font-bold text-green-400 mb-3">ステップ2: ルートの追加</h4>
                        <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mb-6"><code class="language-php">// routes/web.php

// 管理者専用ページ
Route::middleware(['admin'])->group(function () {
    Route::get('/dashboard', function () {
        return view('dashboard');
    })->name('dashboard');
});

// 一般ユーザー用ページ (認証のみ必要)
Route::middleware(['auth'])->group(function () {
    Route::get('/home', function () {
        return view('home');
    })->name('home');
});</code></pre>

                        <div class="bg-gray-800 p-4 rounded-lg mb-6 border-l-4 border-blue-500">
                            <p class="text-gray-300 mb-2"><strong class="text-blue-300">ポイント:</strong></p>
                            <ul class="list-disc ml-6 text-gray-300 space-y-1 text-sm">
                                <li><code>/dashboard</code> - 管理者専用 (<code>admin</code>ミドルウェア)</li>
                                <li><code>/home</code> - 一般ユーザー用 (<code>auth</code>ミドルウェアのみ)</li>
                                <li>役割によって画面を分けることで、権限管理が明確になる</li>
                            </ul>
                        </div>

                        <h4 class="text-xl font-bold text-green-400 mb-3">ステップ3: ログイン後の振り分け</h4>
                        <p class="text-gray-300 mb-3 text-sm">
                            ログイン後に役割に応じて適切な画面へリダイレクトするように、<code>LoginController</code>を修正します。
                        </p>

                        <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto mb-6"><code class="language-php">// app/Http/Controllers/Auth/LoginController.php

public function login(Request $request)
{
    $credentials = $request->validate([
        'email' => 'required|email',
        'password' => 'required',
    ]);

    if (Auth::attempt($credentials)) {
        $request->session()->regenerate();

        // 管理者なら /dashboard へ、一般ユーザーなら /home へ
        if (auth()->user()->isAdmin()) {
            return redirect()->route('dashboard');
        }

        return redirect()->route('home');
    }

    return back()->withErrors([
        'email' => 'メールアドレスまたはパスワードが正しくありません。',
    ])->onlyInput('email');
}</code></pre>

                        <div class="bg-blue-900/30 p-4 rounded-lg mb-6 border-l-4 border-blue-400">
                            <p class="text-sm font-bold text-blue-300 mb-2">💡 何が起きるか？</p>
                            <ul class="text-xs text-gray-300 space-y-2 ml-3">
                                <li>✅ 管理者: ログイン後 → <code>/dashboard</code> へ自動リダイレクト</li>
                                <li>✅ 一般ユーザー: ログイン後 → <code>/home</code> へ自動リダイレクト</li>
                                <li>✅ 一般ユーザーが <code>/dashboard</code> に直接アクセス → 403エラー</li>
                            </ul>
                        </div>

                        <h4 class="text-xl font-bold text-green-400 mb-3">実践: 動作確認</h4>
                        <div class="bg-gray-800 p-4 rounded-lg mb-6 border-l-4 border-green-500">
                            <p class="text-xs font-bold text-green-300 mb-2">1️⃣ 管理者でログイン</p>
                            <ul class="text-xs text-gray-300 ml-4 space-y-1 mb-3">
                                <li>• Email: <code>admin@example.com</code></li>
                                <li>• ログイン後 → <strong class="text-green-300">/dashboard へ自動リダイレクト</strong></li>
                            </ul>

                            <p class="text-xs font-bold text-yellow-300 mb-2 mt-4">2️⃣ 一般ユーザーでログイン</p>
                            <ul class="text-xs text-gray-300 ml-4 space-y-1 mb-3">
                                <li>• Email: <code>user@example.com</code></li>
                                <li>• ログイン後 → <strong class="text-green-300">/home へ自動リダイレクト</strong></li>
                            </ul>

                            <p class="text-xs font-bold text-red-300 mb-2 mt-4">3️⃣ 一般ユーザーが /dashboard にアクセスしようとすると</p>
                            <ul class="text-xs text-gray-300 ml-4 space-y-1">
                                <li>• URLに直接 <code>http://localhost/dashboard</code> を入力</li>
                                <li>• <strong class="text-red-300">403エラー!</strong> 管理者専用のため</li>
                            </ul>
                        </div>

                        <p class="text-green-300 mt-4">
                            ✅ 役割に応じた画面の振り分けが実装できました！
                        </p>
                    </div>

                    <div class="content-section">
                        <h3 class="text-2xl font-bold text-blue-300 mb-6 border-b border-gray-700 pb-2">まとめ</h3>

                        <div class="bg-gray-800 p-6 rounded-lg mb-6 border-l-4 border-green-500">
                            <h4 class="text-xl font-bold text-green-400 mb-4">この章で学んだこと</h4>

                            <ul class="list-disc ml-6 text-gray-300 space-y-2">
                                <li><strong>認証と認可の違い</strong> - 「あなたは誰？」と「あなたには権限がある？」</li>
                                <li><strong>ミドルウェアの仕組み</strong> - コントローラー実行前のチェック、<code>$next($request)</code>で進む</li>
                                <li><strong>ミドルウェアファイルの構造</strong> - <code>handle()</code>メソッド、<code>$request</code>と<code>$next</code></li>
                                <li><strong>enum型でロール管理</strong> - <code>enum('role', ['admin', 'user'])</code>で型安全に</li>
                                <li><strong>カスタムミドルウェア作成</strong> - <code>php artisan make:middleware IsAdmin</code></li>
                                <li><strong>ミドルウェア登録</strong> - <code>bootstrap/app.php</code>の<code>withMiddleware()</code>で<code>alias()</code>登録</li>
                                <li><strong>ルートへの適用</strong> - <code>Route::middleware(['admin'])->group()</code>でグループ化</li>
                                <li><strong>役割別画面の振り分け</strong> - 管理者は<code>/dashboard</code>、一般ユーザーは<code>/home</code></li>
                                <li><strong>ログイン後のリダイレクト</strong> - <code>LoginController</code>で<code>isAdmin()</code>判定して振り分け</li>
                            </ul>
                        </div>

                        <div class="bg-gray-800 p-6 rounded-lg mb-6 border-l-4 border-blue-500">
                            <h4 class="text-xl font-bold text-blue-400 mb-4">重要なポイント</h4>

                            <div class="space-y-4">
                                <div>
                                    <p class="text-sm font-bold text-yellow-300 mb-2">1. ミドルウェアは「番人」</p>
                                    <p class="text-xs text-gray-300">
                                        条件を満たせば<code>return $next($request)</code>で次へ、満たさなければ<code>return redirect()</code>や<code>abort()</code>で止める
                                    </p>
                                </div>

                                <div>
                                    <p class="text-sm font-bold text-yellow-300 mb-2">2. adminミドルウェアでログインチェックも行う</p>
                                    <p class="text-xs text-gray-300">
                                        <code>middleware(['admin'])</code>だけで、ログインチェック+管理者チェックの両方を実行
                                    </p>
                                </div>

                                <div>
                                    <p class="text-sm font-bold text-yellow-300 mb-2">3. group()でまとめて適用</p>
                                    <p class="text-xs text-gray-300">
                                        複数のルートに同じミドルウェアを適用する場合は<code>Route::middleware()->group()</code>を使う
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-800 p-6 rounded-lg mb-6 border-l-4 border-purple-500">
                            <h4 class="text-xl font-bold text-purple-400 mb-4">実践で身につけたスキル</h4>
                            <ul class="list-disc ml-6 text-gray-300 space-y-2 text-sm">
                                <li><code>usersテーブル</code>に<code>enum</code>型の<code>role</code>カラムを追加</li>
                                <li><code>User</code>モデルに<code>isAdmin()</code>メソッドを追加</li>
                                <li><code>IsAdmin</code>ミドルウェアでログイン・管理者チェックを実装</li>
                                <li><code>bootstrap/app.php</code>で<code>'admin' => IsAdmin::class</code>と登録</li>
                                <li><code>routes/web.php</code>で管理者用・一般ユーザー用ルートを分離</li>
                                <li><code>LoginController</code>で役割に応じたリダイレクト先を振り分け</li>
                                <li>ブラウザで403エラーを確認して権限管理の動作を体験</li>
                            </ul>
                        </div>

                        <p class="text-green-300 mt-6 text-center text-lg">
                            🎉 ミドルウェアによる権限管理が完璧に理解できました！
                        </p>
                    </div>

                </div>
            </div>
        </main>
    </div>

    <!-- Highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/highlight.min.js"></script>

    <script>
        // Highlight.js 初期化
        hljs.highlightAll();

        // DOM読み込み完了後に実行
        document.addEventListener('DOMContentLoaded', function() {
            // コピーボタンの追加
            document.querySelectorAll('pre').forEach(pre => {
                const btn = document.createElement('button');
                btn.classList.add('copy-button');
                btn.textContent = 'COPY';
                btn.addEventListener('click', () => {
                    const code = pre.querySelector('code');
                    let textToCopy = code.textContent;

                    navigator.clipboard.writeText(textToCopy).then(() => {
                        btn.textContent = 'COPIED!';
                        setTimeout(() => {
                            btn.textContent = 'COPY';
                        }, 2000);
                    });
                });
                pre.appendChild(btn);
            });

            // h3の折り畳み機能と目次生成
            const tocList = document.getElementById('toc-list');

            document.querySelectorAll('.content-section h3').forEach((h3, index) => {
                const id = `section-${index}`;
                h3.id = id;

                const wrapper = document.createElement('div');
                wrapper.classList.add('collapsible-content');

                const contentSection = h3.parentElement;
                let nextElement = h3.nextElementSibling;
                const elementsToWrap = [];

                while (nextElement) {
                    elementsToWrap.push(nextElement);
                    nextElement = nextElement.nextElementSibling;
                }

                elementsToWrap.forEach(el => {
                    wrapper.appendChild(el);
                });

                contentSection.appendChild(wrapper);

                h3.addEventListener('click', () => {
                    h3.classList.toggle('collapsed');
                    wrapper.classList.toggle('collapsed');
                });

                const tocItem = document.createElement('a');
                tocItem.href = `#${id}`;
                tocItem.className = 'block px-3 py-2 rounded hover:bg-white/10 transition-colors duration-200 text-gray-300 hover:text-white text-xs cursor-pointer';
                tocItem.textContent = h3.textContent.replace('▼', '').replace('▶', '').trim();
                tocItem.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.getElementById('toc-modal').classList.add('hidden');
                    h3.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
                tocList.appendChild(tocItem);
            });

            // 目次ボタン
            const tocButton = document.getElementById('toc-button');
            const tocModal = document.getElementById('toc-modal');
            const closeToc = document.getElementById('close-toc');

            tocButton.addEventListener('click', () => {
                tocModal.classList.toggle('hidden');
            });

            closeToc.addEventListener('click', () => {
                tocModal.classList.add('hidden');
            });

            document.addEventListener('click', (e) => {
                if (!tocButton.contains(e.target) && !tocModal.contains(e.target)) {
                    tocModal.classList.add('hidden');
                }
            });

            // 全て閉じる/開くボタン
            const toggleAllBtn = document.getElementById('toggle-all');
            const toggleIcon = document.getElementById('toggle-icon');
            const toggleText = document.getElementById('toggle-text');
            let allCollapsed = false;

            toggleAllBtn.addEventListener('click', () => {
                if (allCollapsed) {
                    document.querySelectorAll('.content-section h3').forEach(h3 => {
                        const wrapper = h3.nextElementSibling;
                        if (wrapper && wrapper.classList.contains('collapsible-content')) {
                            h3.classList.remove('collapsed');
                            wrapper.classList.remove('collapsed');
                        }
                    });
                    toggleText.textContent = '全て閉じる';
                    toggleIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />';
                    toggleAllBtn.classList.remove('bg-green-500/20', 'hover:bg-green-500/30', 'border-green-500/30', 'text-green-300', 'hover:text-green-200');
                    toggleAllBtn.classList.add('bg-red-500/20', 'hover:bg-red-500/30', 'border-red-500/30', 'text-red-300', 'hover:text-red-200');
                    allCollapsed = false;
                } else {
                    document.querySelectorAll('.content-section h3').forEach(h3 => {
                        const wrapper = h3.nextElementSibling;
                        if (wrapper && wrapper.classList.contains('collapsible-content')) {
                            h3.classList.add('collapsed');
                            wrapper.classList.add('collapsed');
                        }
                    });
                    toggleText.textContent = '全て開く';
                    toggleIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />';
                    toggleAllBtn.classList.remove('bg-red-500/20', 'hover:bg-red-500/30', 'border-red-500/30', 'text-red-300', 'hover:text-red-200');
                    toggleAllBtn.classList.add('bg-green-500/20', 'hover:bg-green-500/30', 'border-green-500/30', 'text-green-300', 'hover:text-green-200');
                    allCollapsed = true;
                }
            });

            // サイドバー制御
            const sidebar = document.getElementById('sidebar');
            const openSidebarBtn = document.getElementById('open-sidebar');
            const closeSidebarBtn = document.getElementById('close-sidebar');
            const sidebarOverlay = document.getElementById('sidebar-overlay');

            openSidebarBtn.addEventListener('click', () => {
                sidebar.classList.remove('-translate-x-full');
                sidebarOverlay.classList.remove('hidden');
            });

            closeSidebarBtn.addEventListener('click', () => {
                sidebar.classList.add('-translate-x-full');
                sidebarOverlay.classList.add('hidden');
            });

            sidebarOverlay.addEventListener('click', () => {
                sidebar.classList.add('-translate-x-full');
                sidebarOverlay.classList.add('hidden');
            });

            // 上に戻るボタン
            const scrollToTopBtn = document.getElementById('scroll-to-top');

            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    scrollToTopBtn.classList.remove('opacity-0', 'pointer-events-none');
                    scrollToTopBtn.classList.add('opacity-100');
                } else {
                    scrollToTopBtn.classList.add('opacity-0', 'pointer-events-none');
                    scrollToTopBtn.classList.remove('opacity-100');
                }
            });

            scrollToTopBtn.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        });
    </script>
<!-- サイドバーコンポーネント -->

<script src="../js/sidebar.js"></script>
    <script src="../js/footer.js"></script>

</body>

</html>
